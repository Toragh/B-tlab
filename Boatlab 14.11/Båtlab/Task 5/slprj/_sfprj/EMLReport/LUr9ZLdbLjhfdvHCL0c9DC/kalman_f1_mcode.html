<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type0" id="S2T0U3">bias</span>, <span class="var type0" id="S3T0U4">psi</span>] = kalman_f(<span class="var type1" id="S4T1U7">u</span>, <span class="var type1" id="S5T1U8">y</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line">    <span class="keyword">persistent</span> <span class="var type1" id="S6T1U10">init_flag</span> <span class="var type1" id="S7T2U11">x_pri</span> <span class="var type1" id="S8T3U12">P_pri</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line">    <span class="mxinfo " id="T3:U6"><span class="var type1" id="S9T3U15">P_pri_0</span> = <span class="mxinfo " id="T3:U8">[<span class="mxinfo " id="T4:U9"><span class="mxinfo " id="T1:U10">1</span> <span class="mxinfo " id="T1:U11">0</span> <span class="mxinfo " id="T1:U12">0</span> <span class="mxinfo " id="T1:U13">0</span> <span class="mxinfo " id="T1:U14">0</span></span>;<span class="mxinfo " id="T4:U15"><span class="mxinfo " id="T1:U16">0</span> <span class="mxinfo " id="T1:U17">0.013</span> <span class="mxinfo " id="T1:U18">0</span> <span class="mxinfo " id="T1:U19">0</span> <span class="mxinfo " id="T1:U20">0</span></span>; <span class="mxinfo " id="T4:U21"><span class="mxinfo " id="T1:U22">0</span> <span class="mxinfo " id="T1:U23">0</span> <span class="mxinfo " id="T1:U24"><span class="mxinfo " id="T1:U25">pi</span>^2</span> <span class="mxinfo " id="T1:U26">0</span> <span class="mxinfo " id="T1:U27">0</span></span>; <span class="mxinfo " id="T4:U28"><span class="mxinfo " id="T1:U29">0</span> <span class="mxinfo " id="T1:U30">0</span> <span class="mxinfo " id="T1:U31">0</span> <span class="mxinfo " id="T1:U32">1</span> <span class="mxinfo " id="T1:U33">0</span></span>;<span class="mxinfo " id="T4:U34"><span class="mxinfo " id="T1:U35">0</span> <span class="mxinfo " id="T1:U36">0</span> <span class="mxinfo " id="T1:U37">0</span> <span class="mxinfo " id="T1:U38">0</span> <span class="mxinfo " id="T1:U39"><span class="mxinfo " id="T1:U40">2.5</span>*<span class="mxinfo " id="T1:U41"><span class="mxinfo " id="T1:U42">10</span>^-3</span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line">    <span class="mxinfo " id="T2:U43"><span class="var type1" id="S11T2U57">x_pri_0</span> = <span class="mxinfo " id="T2:U45">[<span class="mxinfo " id="T1:U46">0</span>; <span class="mxinfo " id="T1:U47">0</span>; <span class="mxinfo " id="T1:U48">0</span>; <span class="mxinfo " id="T1:U49">0</span>; <span class="mxinfo " id="T1:U50">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line">    <span class="mxinfo " id="T5:U51"><span class="var type1" id="S12T5U71">Q</span> = <span class="mxinfo " id="T5:U53">[<span class="mxinfo " id="T6:U54"><span class="mxinfo " id="T1:U55">30</span> <span class="mxinfo " id="T1:U56">0</span></span>; <span class="mxinfo " id="T6:U57"><span class="mxinfo " id="T1:U58">0</span> <span class="mxinfo " id="T1:U59">10e-6</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line">    <span class="mxinfo " id="T1:U60"><span class="var type1" id="S13T1U81">R</span> = <span class="mxinfo " id="T1:U62">6.051993621726547e-06</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line">    <span class="mxinfo " id="T3:U63"><span class="var type1" id="S14T3U85">I</span> =<span class="mxinfo " id="T3:U65">diag(<span class="mxinfo " id="T4:U66">[1 1 1 1 1]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line">    <span class="mxinfo " id="T3:U67"><span class="var type1" id="S16T3U97">Ad</span> = <span class="mxinfo " id="T3:U69">[<span class="mxinfo " id="T4:U70"><span class="mxinfo " id="T1:U71">0.996954741048002</span> <span class="mxinfo " id="T1:U72">0.0992545087604663</span> <span class="mxinfo " id="T1:U73">0</span> <span class="mxinfo " id="T1:U74">0</span> <span class="mxinfo " id="T1:U75">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line">        <span class="mxinfo " id="T4:U76"><span class="mxinfo " id="T1:U77">-<span class="mxinfo " id="T1:U78">0.0607430933636516</span></span> <span class="mxinfo " id="T1:U79">0.984111959963574</span> <span class="mxinfo " id="T1:U80">0</span> <span class="mxinfo " id="T1:U81">0</span> <span class="mxinfo " id="T1:U82">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line">        <span class="mxinfo " id="T4:U83"><span class="mxinfo " id="T1:U84">0</span> <span class="mxinfo " id="T1:U85">0</span> <span class="mxinfo " id="T1:U86">1</span> <span class="mxinfo " id="T1:U87">0.0999310050168264</span> <span class="mxinfo " id="T1:U88">-<span class="mxinfo " id="T1:U89">1.07701168734005e-05</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line">        <span class="mxinfo " id="T4:U90"><span class="mxinfo " id="T1:U91">0</span> <span class="mxinfo " id="T1:U92">0</span> <span class="mxinfo " id="T1:U93">0</span> <span class="mxinfo " id="T1:U94">0.998620417763384</span> <span class="mxinfo " id="T1:U95">-<span class="mxinfo " id="T1:U96">0.000215352787135716</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line">        <span class="mxinfo " id="T4:U97"><span class="mxinfo " id="T1:U98">0</span> <span class="mxinfo " id="T1:U99">0</span> <span class="mxinfo " id="T1:U100">0</span> <span class="mxinfo " id="T1:U101">0</span> <span class="mxinfo " id="T1:U102">1</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line">    <span class="mxinfo " id="T2:U103"><span class="var type1" id="S17T2U134">Bd</span> = <span class="mxinfo " id="T2:U105">[<span class="mxinfo " id="T1:U106">0</span>;<span class="mxinfo " id="T1:U107">0</span>;<span class="mxinfo " id="T1:U108">1.07701168734005e-05</span>;<span class="mxinfo " id="T1:U109">0.000215352787135716</span>;<span class="mxinfo " id="T1:U110">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">    <span class="mxinfo " id="T4:U111"><span class="var type1" id="S18T4U148">Cd</span> = <span class="mxinfo " id="T4:U113">[<span class="mxinfo " id="T1:U114">0</span> <span class="mxinfo " id="T1:U115">1</span> <span class="mxinfo " id="T1:U116">1</span> <span class="mxinfo " id="T1:U117">0</span> <span class="mxinfo " id="T1:U118">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">    <span class="mxinfo " id="T7:U119"><span class="var type1" id="S19T7U158">Ed</span> = <span class="mxinfo " id="T7:U121">[<span class="mxinfo " id="T6:U122"><span class="mxinfo " id="T1:U123">1.811858664137177e-05</span> <span class="mxinfo " id="T1:U124">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">        <span class="mxinfo " id="T6:U125"><span class="mxinfo " id="T1:U126">3.614073605307908e-04</span> <span class="mxinfo " id="T1:U127">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">        <span class="mxinfo " id="T6:U128"><span class="mxinfo " id="T1:U129">0</span> <span class="mxinfo " id="T1:U130">-<span class="mxinfo " id="T1:U131">3.590451934240905e-07</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">        <span class="mxinfo " id="T6:U132"><span class="mxinfo " id="T1:U133">0</span> <span class="mxinfo " id="T1:U134">-<span class="mxinfo " id="T1:U135">1.077011687340049e-05</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">        <span class="mxinfo " id="T6:U136"><span class="mxinfo " id="T1:U137">0</span> <span class="mxinfo " id="T1:U138">0.100000000000000</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo " id="T8:U139">isempty(<span class="var type0" id="S6T0U182">init_flag</span>)</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">        <span class="mxinfo " id="T1:U140"><span class="var type1" id="S6T1U185">init_flag</span> = <span class="mxinfo " id="T1:U142">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">        <span class="mxinfo " id="T3:U143"><span class="var type1" id="S8T3U189">P_pri</span> = <span class="var type1" id="S9T3U190">P_pri_0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">        <span class="mxinfo " id="T2:U146"><span class="var type1" id="S7T2U193">x_pri</span> = <span class="var type1" id="S11T2U194">x_pri_0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">        <span class="mxinfo " id="T9:U149"><span class="autoExtrinsicFcn" id="F42N2:B197">disp</span>(<span class="var type1" id="S6T1U198">init_flag</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">        <span class="var type0" id="S22T0U201">K</span> = (<span class="message error" id="M1F1C"><span class="var type1" id="S8T3U205">P_pri</span>.*<span class="mxinfo " id="T2:U152"><span class="var type1" id="S18T4U207">Cd</span>'</span></span>).*((<span class="var type0" id="S18T0U214">Cd</span>.*<span class="var type0" id="S8T0U215">P_pri</span>.*<span class="var type0" id="S18T0U217">Cd</span>'+<span class="var type0" id="S13T0U218">R</span>)');</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">        <span class="var type0" id="S23T0U221">x</span> = <span class="var type1" id="S7T2U223">x_pri</span> + <span class="var type0" id="S22T0U225"><span class="message error" id="M2F1C">K</span></span>.*(<span class="var type0" id="S5T0U228">y</span>-<span class="var type0" id="S18T0U230">Cd</span>.*<span class="var type0" id="S7T0U231">x_pri</span>); </span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">        <span class="var type0" id="S24T0U234">P</span> = (<span class="var type1" id="S14T3U240">I</span>-<span class="var type0" id="S22T0U242"><span class="message error" id="M3F1C">K</span></span>.*<span class="var type0" id="S18T0U243">Cd</span>).*<span class="var type0" id="S8T0U244">P_pri</span>.*(<span class="var type0" id="S14T0U248">I</span>-<span class="var type0" id="S22T0U250">K</span>.*<span class="var type0" id="S18T0U251">Cd</span>)'+<span class="var type0" id="S22T0U254">K</span>.*<span class="var type0" id="S13T0U255">R</span>.*<span class="var type0" id="S22T0U257">K</span>';</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line">        <span class="var type0" id="S7T0U260">x_pri</span> = <span class="var type1" id="S16T3U263">Ad</span>.*<span class="var type0" id="S23T0U264"><span class="message error" id="M4F1C">x</span></span> + <span class="var type0" id="S17T0U266">Bd</span>.*<span class="var type0" id="S4T0U267">u</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">        <span class="var type0" id="S8T0U270">P_pri</span> = <span class="var type1" id="S16T3U274">Ad</span>.*<span class="var type0" id="S24T0U275"><span class="message error" id="M5F1C">P</span></span>.*(<span class="var type0" id="S16T0U278">Ad</span>') + <span class="var type0" id="S19T0U281">Ed</span>.*<span class="var type0" id="S12T0U282">Q</span>.*(<span class="var type0" id="S19T0U285">Ed</span>');</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line">        <span class="var type0" id="S3T0U288">psi</span> = <span class="var type0" id="S23T0U290"><span class="message error" id="M6F1C">x</span></span>(3);</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line">        <span class="var type0" id="S2T0U294">bias</span> = <span class="var type0" id="S23T0U296"><span class="message error" id="M7F1C">x</span></span>(5);</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
</body>
</html>
